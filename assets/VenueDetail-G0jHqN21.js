import{b as l,u as q,e as J,f as K,y as c,j as e,h as Q,D as F,C as X,U as Y}from"./index-ChEsYP5c.js";import{a as I}from"./api-CP9qqBuO.js";import{r as ee}from"./renderStars-Jiei4OIp.js";import{B as te}from"./BackButton-D9MkhJQl.js";function ae({title:r,titleId:n,...u},t){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},u),r?l.createElement("title",{id:n},r):null,l.createElement("path",{fillRule:"evenodd",d:"M7.72 12.53a.75.75 0 0 1 0-1.06l7.5-7.5a.75.75 0 1 1 1.06 1.06L9.31 12l6.97 6.97a.75.75 0 1 1-1.06 1.06l-7.5-7.5Z",clipRule:"evenodd"}))}const se=l.forwardRef(ae);function le({title:r,titleId:n,...u},t){return l.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:t,"aria-labelledby":n},u),r?l.createElement("title",{id:n},r):null,l.createElement("path",{fillRule:"evenodd",d:"M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z",clipRule:"evenodd"}))}const re=l.forwardRef(le),P="https://v2.api.noroff.dev/holidaze";function ce(){var v,j,y,N,k,C,S,D,R;const{id:r}=q(),n=J(),{user:u}=K(),[t,$]=l.useState(null),[f,z]=l.useState(""),[L,M]=l.useState([null,null]),[g,m]=l.useState(0),[p,b]=l.useState(null),[w,T]=l.useState(!1),i=l.useRef(),[h,x]=L;l.useEffect(()=>{(async()=>{try{const a=await fetch(`${P}/venues/${r}?_bookings=true`,{headers:I()});if(!a.ok)throw new Error("Failed to fetch venue");const s=await a.json();$(s.data)}catch(a){c.error("Could not load venue."),console.error(a)}})()},[r]),l.useEffect(()=>{var a;if((a=t==null?void 0:t.media)!=null&&a.length)return i.current=setInterval(()=>{m(s=>(s+1)%t.media.length)},4e3),()=>clearInterval(i.current)},[t]);const A=()=>clearInterval(i.current),H=()=>{i.current||(i.current=setInterval(()=>{m(a=>(a+1)%t.media.length)},4e3))},O=async a=>{var B;if(a.preventDefault(),!h||!x||!f){c.error("Please fill all booking fields.");return}const s=o=>new Date(o).setHours(0,0,0,0);if((B=t.bookings)==null?void 0:B.some(o=>{const U=s(o.dateFrom),G=s(o.dateTo),W=s(h),Z=s(x);return W<=G&&Z>=U})){c.error("Selected dates are already booked.");return}try{if(!(await fetch(`${P}/bookings`,{method:"POST",headers:I(),body:JSON.stringify({dateFrom:h,dateTo:x,guests:f,venueId:r})})).ok)throw new Error("Booking failed");c.success("Booking confirmed!"),n("/customer")}catch(o){console.error(o),c.error("Failed to book venue."),n("/login")}};if(!t)return e.jsx("div",{className:"text-center py-10",children:"Loading venue..."});const V=[(v=t.location)==null?void 0:v.address,(j=t.location)==null?void 0:j.city,(y=t.location)==null?void 0:y.country].filter(Boolean).join(", "),_=(((k=(N=t.meta)==null?void 0:N.bookings)==null?void 0:k.length)||0)>=10,d=[];return(C=t.bookings)==null||C.forEach(a=>{let s=new Date(a.dateFrom);const E=new Date(a.dateTo);for(;s<=E;)d.push(new Date(s.setHours(0,0,0,0))),s=Q(s,1)}),e.jsxs("main",{className:"font-[Poppins] max-w-4xl mx-auto p-4",children:[e.jsxs("div",{className:"border-2 border-[#C07059] rounded-2xl shadow container mx-auto px-4 py-8 font-[Poppins]",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("h1",{className:"text-3xl font-bold truncate",children:t.name}),_&&e.jsx("span",{className:"bg-red-100 text-red-600 text-sm px-2 py-1 rounded-full font-semibold",children:"❤️ Popular"})]}),((S=t.media)==null?void 0:S.length)>0&&e.jsxs("div",{className:"relative w-full h-64 mb-6 overflow-hidden rounded-2xl",onMouseEnter:A,onMouseLeave:H,children:[e.jsx("img",{src:t.media[g].url,alt:`${t.name} image`,className:"w-full h-full object-cover",onClick:()=>b(t.media[g].url)}),e.jsx("button",{onClick:()=>m(a=>(a-1+t.media.length)%t.media.length),className:"absolute top-1/2 left-3 transform -translate-y-1/2 bg-white text-gray-800 shadow-md rounded-full p-2",children:e.jsx(se,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>m(a=>(a+1)%t.media.length),className:"absolute top-1/2 right-3 transform -translate-y-1/2 bg-white text-gray-800 shadow-md rounded-full p-2",children:e.jsx(re,{className:"h-5 w-5"})})]}),p&&e.jsx("div",{onClick:()=>b(null),className:"fixed inset-0 bg-black bg-opacity-80 z-50 flex items-center justify-center",children:e.jsx("img",{src:p,alt:"Full View",className:"max-w-full max-h-full"})}),e.jsx("p",{className:"mb-2 text-gray-700",children:t.description}),e.jsx("p",{className:"mb-2 text-sm text-gray-500",children:V}),e.jsxs("p",{className:"mb-4 text-lg font-semibold",children:["$",t.price," / night ",t.rating!==void 0&&ee(t.rating)]}),((D=t.location)==null?void 0:D.lat)&&((R=t.location)==null?void 0:R.lng)&&e.jsx("iframe",{title:"Map",width:"100%",height:"300",className:"rounded mb-6",style:{border:0},loading:"lazy",allowFullScreen:!0,src:`https://maps.google.com/maps?q=${t.location.lat},${t.location.lng}&z=14&output=embed`}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-4 mb-6 w-full max-w-2xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col justify-between items-center mb-2",children:[e.jsx("h3",{className:"text-xl font-semibold",children:"Availability"}),e.jsx("button",{className:"text-sm text-blue-600 hover:underline sm:hidden",onClick:()=>T(a=>!a),children:w?"Hide Calendar":"Show Calendar"})]}),e.jsx("p",{className:"text-sm text-gray-500 mb-4 text-center",children:"Booked dates are marked in red"}),(w||window.innerWidth>=640)&&e.jsx("div",{className:"overflow-x-auto flex justify-center gap-2",children:e.jsx(F,{inline:!0,monthsShown:window.innerWidth<640?1:2,highlightDates:[{"react-datepicker__day--booked":d}],dayClassName:a=>d.some(s=>s.toDateString()===a.toDateString())?"booked-date":void 0})})]}),e.jsxs("form",{onSubmit:O,className:"flex flex-col sm:flex-row flex-wrap justify-between items-center gap-4 bg-white p-4 rounded-2xl shadow-lg mb-6",children:[e.jsxs("div",{className:"relative w-45",children:[e.jsx(X,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-red-400",size:18}),e.jsx(F,{selectsRange:!0,startDate:h,endDate:x,onChange:a=>M(a),placeholderText:"Check in - out",className:"pl-10 border-2 border-[#C07059] rounded-2xl px-4 py-2 w-full",excludeDates:d,dayClassName:a=>d.some(s=>s.toDateString()===a.toDateString())?"booked-date":void 0})]}),e.jsxs("div",{className:"relative w-45",children:[e.jsx(Y,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-red-400",size:18}),e.jsx("input",{type:"number",min:1,value:f,onChange:a=>z(+a.target.value),className:"pl-10 border-2 border-[#C07059] rounded-2xl px-4 py-2 w-full",placeholder:"Guests"})]}),e.jsx("button",{type:"submit",className:"button-color text-white px-6 py-2 rounded-2xl hover:bg-black transition hover:scale-[1.02]",children:"Confirm Booking"})]})]}),e.jsx(te,{})]})}export{ce as default};
