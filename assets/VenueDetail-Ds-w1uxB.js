import{b as r,u as Q,f as X,h as Y,i as I,y as m,j as t,k as ee,D as G,C as te,U as se}from"./index-C-TlXThf.js";import{r as ae}from"./renderStars-BLkpZnmw.js";import{B as re}from"./BackButton-B7ui8dff.js";function le({title:l,titleId:o,...x},e){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:e,"aria-labelledby":o},x),l?r.createElement("title",{id:o},l):null,r.createElement("path",{fillRule:"evenodd",d:"M7.72 12.53a.75.75 0 0 1 0-1.06l7.5-7.5a.75.75 0 1 1 1.06 1.06L9.31 12l6.97 6.97a.75.75 0 1 1-1.06 1.06l-7.5-7.5Z",clipRule:"evenodd"}))}const oe=r.forwardRef(le);function ne({title:l,titleId:o,...x},e){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:e,"aria-labelledby":o},x),l?r.createElement("title",{id:o},l):null,r.createElement("path",{fillRule:"evenodd",d:"M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 0 1 1.06-1.06l7.5 7.5Z",clipRule:"evenodd"}))}const ie=r.forwardRef(ne),P="https://v2.api.noroff.dev/holidaze";function me(){var y,N,k,C,S,D,E,R,$;const{id:l}=Q(),o=X(),{user:x}=Y(),[e,z]=r.useState(null),[d,M]=r.useState(""),[i,b]=r.useState(""),[L,T]=r.useState([null,null]),[p,h]=r.useState(0),[w,v]=r.useState(null),[j,A]=r.useState(!1),c=r.useRef(),[f,g]=L;r.useEffect(()=>{(async()=>{try{const s=await fetch(`${P}/venues/${l}?_bookings=true`,{headers:I()});if(!s.ok)throw new Error("Failed to fetch venue");const a=await s.json();z(a.data)}catch(s){m.error("Could not load venue."),console.error(s)}})()},[l]),r.useEffect(()=>{var s;if((s=e==null?void 0:e.media)!=null&&s.length)return c.current=setInterval(()=>{h(a=>(a+1)%e.media.length)},4e3),()=>clearInterval(c.current)},[e]);const H=s=>{const a=+s.target.value;M(a),!a||a<1?b("Guests must be at least 1"):e&&a>e.maxGuests?b(`Max allowed is ${e.maxGuests}`):b("")},O=async s=>{var F;if(s.preventDefault(),!f||!g||!d||i){m.error("Please fill all booking fields correctly.");return}const a=n=>new Date(n).setHours(0,0,0,0);if((F=e.bookings)==null?void 0:F.some(n=>{const Z=a(n.dateFrom),q=a(n.dateTo),J=a(f),K=a(g);return J<=q&&K>=Z})){m.error("Selected dates are already booked.");return}try{if(!(await fetch(`${P}/bookings`,{method:"POST",headers:I(),body:JSON.stringify({dateFrom:f,dateTo:g,guests:d,venueId:l})})).ok)throw new Error("Booking failed");m.success("Booking confirmed!"),o("/customer")}catch(n){console.error(n),m.error("Failed to book venue."),o("/login")}};if(!e)return t.jsx("div",{className:"text-center py-10",children:"Loading venue..."});const V=(((N=(y=e.meta)==null?void 0:y.bookings)==null?void 0:N.length)||0)>=10,_=[(k=e.location)==null?void 0:k.address,(C=e.location)==null?void 0:C.city,(S=e.location)==null?void 0:S.country].filter(Boolean).join(", "),u=[];(D=e.bookings)==null||D.forEach(s=>{let a=new Date(s.dateFrom);const B=new Date(s.dateTo);for(;a<=B;)u.push(new Date(a.setHours(0,0,0,0))),a=ee(a,1)});const U=()=>{clearInterval(c.current)},W=()=>{c.current||(c.current=setInterval(()=>{h(s=>(s+1)%e.media.length)},4e3))};return t.jsxs("main",{className:"font-[Poppins] max-w-4xl mx-auto p-4",children:[t.jsxs("div",{className:"border-2 border-[#C07059] rounded-2xl shadow container mx-auto px-4 py-8 font-[Poppins]",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[t.jsx("h1",{className:"text-3xl font-bold truncate",children:e.name}),V&&t.jsx("span",{className:"bg-red-100 text-red-600 text-sm px-2 py-1 rounded-full font-semibold",children:"❤️ Popular"})]}),((E=e.media)==null?void 0:E.length)>0&&t.jsxs("div",{className:"relative w-full h-64 mb-6 overflow-hidden rounded-2xl",onMouseEnter:U,onMouseLeave:W,children:[t.jsx("img",{src:e.media[p].url,alt:`${e.name} image`,className:"w-full h-full object-cover",onClick:()=>v(e.media[p].url)}),t.jsx("button",{onClick:()=>h(s=>(s-1+e.media.length)%e.media.length),className:"absolute top-1/2 left-3 transform -translate-y-1/2 bg-white text-gray-800 shadow-md rounded-full p-2",children:t.jsx(oe,{className:"h-5 w-5"})}),t.jsx("button",{onClick:()=>h(s=>(s+1)%e.media.length),className:"absolute top-1/2 right-3 transform -translate-y-1/2 bg-white text-gray-800 shadow-md rounded-full p-2",children:t.jsx(ie,{className:"h-5 w-5"})})]}),w&&t.jsx("div",{onClick:()=>v(null),className:"fixed inset-0 bg-black bg-opacity-80 z-50 flex items-center justify-center",children:t.jsx("img",{src:w,alt:"Full View",className:"max-w-full max-h-full"})}),t.jsx("p",{className:"mb-2 text-gray-700",children:e.description}),t.jsxs("p",{className:"mb-2 text-sm text-gray-500 italic",children:["📍",_]}),t.jsxs("p",{className:"mb-2 text-lg font-semibold",children:["$",e.price," / night"]}),e.rating!==void 0&&t.jsx("p",{className:"justify-left flex",children:ae(e.rating)}),((R=e.location)==null?void 0:R.lat)&&(($=e.location)==null?void 0:$.lng)&&t.jsx("iframe",{title:"Map",width:"100%",height:"300",className:"rounded mb-6",style:{border:0},loading:"lazy",allowFullScreen:!0,src:`https://maps.google.com/maps?q=${e.location.lat},${e.location.lng}&z=14&output=embed`}),t.jsxs("div",{className:"border-2 border-[#C07059] bg-white rounded-2xl shadow-lg p-4 mb-6 w-full max-w-2xl mx-auto",children:[t.jsxs("div",{className:"flex flex-col justify-between items-center mb-2",children:[t.jsx("h3",{className:"text-xl font-semibold",children:"Availability"}),t.jsx("button",{className:"text-sm text-blue-600 hover:underline sm:hidden",onClick:()=>A(s=>!s),children:j?"Hide Calendar":"Show Calendar"})]}),t.jsx("p",{className:"text-sm text-gray-500 mb-4 text-center",children:"Booked dates are marked in red"}),(j||window.innerWidth>=640)&&t.jsx("div",{className:"overflow-x-auto flex justify-center gap-2",children:t.jsx(G,{inline:!0,monthsShown:window.innerWidth<640?1:2,highlightDates:[{"react-datepicker__day--booked":u}],dayClassName:s=>u.some(a=>a.toDateString()===s.toDateString())?"booked-date":void 0})})]}),t.jsxs("form",{onSubmit:O,className:"flex flex-col sm:flex-row flex-wrap border-2 border-[#C07059] justify-between items-center gap-4 bg-white p-4 rounded-2xl shadow-lg mb-6",children:[t.jsxs("div",{className:"relative w-45",children:[t.jsx(te,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-red-400",size:18}),t.jsx(G,{selectsRange:!0,startDate:f,endDate:g,onChange:s=>T(s),placeholderText:"Check - in/out",className:"pl-10 border-2 border-[#C07059] rounded-2xl px-4 py-2 w-full",excludeDates:u,dayClassName:s=>u.some(a=>a.toDateString()===s.toDateString())?"booked-date":void 0})]}),t.jsxs("div",{className:"relative w-45",children:[t.jsx(se,{className:"absolute left-3 top-1/3 -translate-y-1/2 text-red-400",size:18}),t.jsx("input",{type:"number",min:1,value:d,onChange:H,className:`pl-10 border-2 px-4 py-2 w-full rounded-2xl ${i?"border-red-500":"border-[#C07059]"}`,placeholder:"Guests"}),t.jsx("p",{className:`text-sm mt-1 ${i?"text-red-500":"text-gray-500"}`,children:i||`Max allowed: ${e.maxGuests}`})]}),t.jsx("button",{type:"submit",disabled:i||!d,className:`font-semibold text-white px-6 py-2 rounded-2xl transition hover:scale-[1.02] ${i||!d?"bg-gray-400 cursor-not-allowed":"button-color hover:bg-black"}`,children:"Confirm Booking"})]})]}),t.jsx(re,{})]})}export{me as default};
