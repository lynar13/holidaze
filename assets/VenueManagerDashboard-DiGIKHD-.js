import{v as g,j as e,h as z,f as L,b as n,i as D,w as q,y as c,S as F,d as G,s as H,x as I,q as T}from"./index-C-TlXThf.js";import{B as J}from"./BackButton-B7ui8dff.js";import{r as K}from"./renderStars-BLkpZnmw.js";import{V as O,A as Q}from"./VenueCard-DpziqqKN.js";import{S as P}from"./SafeImage-CmomU2AK.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]],X=g("pencil",W);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],Z=g("plus",Y);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]],ae=g("trash-2",ee);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]],se=g("user-cog",te),re=({form:t,setForm:h,onClose:o,onSave:i,loading:d=!1})=>e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white p-6 rounded-xl w-full max-w-md shadow-xl relative",children:[e.jsx("button",{onClick:o,className:"absolute top-2 right-4 text-2xl cursor-pointer",children:"×"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Edit Profile"}),e.jsx("label",{className:"block text-sm font-medium",children:"Avatar URL"}),e.jsx("input",{type:"url",value:t.avatarUrl,onChange:r=>h(m=>({...m,avatarUrl:r.target.value})),className:"w-full border px-3 py-2 rounded mb-4"}),t.avatarUrl&&e.jsx(P,{src:t.avatarUrl,alt:"Avatar preview",className:"w-16 h-16 mx-auto rounded-full mb-4 border object-cover"}),e.jsx("label",{className:"block text-sm font-medium",children:"Banner URL"}),e.jsx("input",{type:"url",value:t.bannerUrl,onChange:r=>h(m=>({...m,bannerUrl:r.target.value})),className:"w-full border px-3 py-2 rounded mb-4"}),t.bannerUrl&&e.jsx(P,{src:t.bannerUrl,alt:"Banner preview",className:"w-full h-24 object-cover rounded mb-4"}),e.jsx("button",{onClick:i,disabled:d,className:"button-color font-semibold text-white px-6 py-2 rounded-2xl w-full sm:w-auto transition-transform duration-150 hover:scale-[1.02] cursor-pointer",children:d?"Saving...":"Save Changes"})]})}),de=()=>{var v,y,N,w,k;const{user:t,setUser:h}=z(),o=L(),[i,d]=n.useState([]),[r,m]=n.useState([]),[x,b]=n.useState(1),[M,V]=n.useState(!0),[A,u]=n.useState(!1),[f,E]=n.useState({avatarUrl:((v=t==null?void 0:t.avatar)==null?void 0:v.url)||"",bannerUrl:((y=t==null?void 0:t.banner)==null?void 0:y.url)||""});D(),n.useEffect(()=>{t!=null&&t.venueManager&&t.name&&q(t.name).then(d).catch(()=>c.error("Error fetching venues")).finally(()=>V(!1))},[t]);const B=async a=>{if(window.confirm("Are you sure you want to delete this venue?"))try{await I(a),d(s=>s.filter(l=>l.id!==a)),c.success("Venue deleted")}catch{c.error("Failed to delete venue")}},R=async()=>{try{const a={avatar:{url:f.avatarUrl.trim()||`https://ui-avatars.com/api/?name=${t.name}`,alt:"User Avatar"},banner:{url:f.bannerUrl.trim(),alt:"User Banner"}};await T(t.name,a),h(s=>({...s,avatar:a.avatar,banner:a.banner})),c.success("Profile updated"),u(!1)}catch(a){c.error("Failed to update profile"),console.error(a)}},_=async a=>{try{const s=await G(),l=H(s,a.search);l.length===1?o(`/venues/${l[0].id}`):(m(l),b(1))}catch{c.error("Search failed")}},p=6,$=r.slice((x-1)*p,x*p);return t!=null&&t.venueManager?e.jsxs("main",{className:"p-4 font-[Poppins] max-w-6xl mx-auto",children:[((N=t.banner)==null?void 0:N.url)&&e.jsxs("div",{className:"relative mb-12",children:[e.jsx("img",{src:t.banner.url,alt:"Banner",className:"w-full h-40 object-cover rounded-xl"}),e.jsxs("div",{className:"absolute left-4 bottom-[-6rem] sm:left-8 flex items-center gap-4 p-2",children:[e.jsx("img",{src:((w=t.avatar)==null?void 0:w.url)||`https://ui-avatars.com/api/?name=${encodeURIComponent(t.name)}`,alt:"Avatar",className:"w-24 h-24 rounded-full border-4 border-white shadow"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-semibold",children:t.name}),e.jsx("p",{className:"text-gray-600 text-xs break-words",children:t==null?void 0:t.email}),e.jsx("button",{onClick:()=>u(!0),className:"mt-2 button-color font-semibold text-white px-5 py-1.5 rounded-xl text-sm cursor-pointer",children:"Edit Profile"})]})]})]}),e.jsx("div",{className:"relative z-20 max-w-5xl mx-auto mb-8 bottom-[-4rem]",children:e.jsx(F,{onFilterChange:_})}),r.length>0&&e.jsxs("section",{className:"mb-8 p-8",children:[e.jsx("h3",{className:"text-3xl font-semibold mb-4",children:"Search Results"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 p-4",children:$.map((a,s)=>e.jsx(O,{venue:a,index:s,filters:{}},a.id))}),e.jsxs("div",{className:"mt-4 flex justify-center items-center gap-4",children:[e.jsx("button",{onClick:()=>b(a=>Math.max(a-1,1)),disabled:x===1,className:"px-3 py-1 button-color text-white rounded-2xl disabled:opacity-50",children:"Prev"}),e.jsxs("span",{children:["Page ",x]}),e.jsx("button",{onClick:()=>b(a=>a*p<r.length?a+1:a),disabled:x*p>=r.length,className:"px-3 py-1 button-color text-white rounded-2xl disabled:opacity-50",children:"Next"})]})]}),e.jsxs("section",{className:"mb-12 py-6 px-2",children:[e.jsxs("div",{className:"mt-4 p-6 flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6 px-2 sm:px-4",children:[e.jsxs("h1",{className:"text-5xl font-bold",children:["Managed Venues (",((k=t._count)==null?void 0:k.venues)||i.length,")"]}),e.jsxs("div",{className:"flex flex-wrap gap-2 font-semibold",children:[e.jsxs("button",{onClick:()=>o("/create-venue"),className:"button-color text-white px-4 py-1 rounded-xl flex items-center gap-2 cursor-pointer",children:[e.jsx(Z,{className:"w-4 h-4"})," Create Venue"]}),e.jsxs("button",{onClick:()=>u(!0),className:"button-color text-white px-4 py-1 rounded-xl flex items-center gap-2 cursor-pointer",children:[e.jsx(se,{className:"w-4 h-4"})," Edit Avatar"]})]})]}),M?e.jsx("p",{className:"text-center text-gray-500 py-6",children:"Loading venues..."}):i.length===0?e.jsx("p",{className:"text-center text-gray-400 py-6",children:"No managed venues found."}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-2 gap-6 sm:px-4 p-2",children:i.map(a=>{var U,S,C;const s=((U=a.bookings)==null?void 0:U.length)||0,l=s<(a.maxGuests||1);return e.jsxs("div",{onClick:()=>o(`/venue-manager/${a.id}`),className:"p-4 border-2 border-[#C07059] bg-white hover:ring-2 hover:ring-[#e85c4f] rounded-2xl shadow flex flex-col items-center cursor-pointer animate-fade-in hover:scale-[1.02] transition",children:[(C=(S=a.media)==null?void 0:S[0])!=null&&C.url?e.jsx("img",{src:a.media[0].url,alt:a.media[0].alt||a.name,className:"w-full h-40 object-cover rounded-md mb-3"}):e.jsx("div",{className:"w-full h-40 bg-gray-200 rounded-md mb-3 flex items-center justify-center text-sm text-gray-500",children:"No image"}),e.jsx("h3",{className:"text-lg font-semibold truncate",children:a.name}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:a.description||"No description"}),e.jsxs("p",{className:"text-sm text-gray-500 font-semibold mt-1",children:["Price: $",a.price," / night • Max Guests:"," ",a.maxGuests]}),a.rating!==void 0&&K(a.rating),e.jsxs("p",{className:"text-sm text-gray-500",children:["Total bookings: ",s]}),e.jsx(Q,{isAvailable:l}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx("button",{onClick:j=>{j.stopPropagation(),o(`/edit-venue/${a.id}`)},className:"p-2 rounded hover:bg-gray-100 text-blue-500",title:"Edit","aria-label":"Edit venue",children:e.jsx(X,{className:"w-5 h-5"})}),e.jsx("button",{onClick:j=>{j.stopPropagation(),B(a.id)},className:"p-2 rounded hover:bg-gray-100 text-red-500",title:"Delete","aria-label":"Delete venue",children:e.jsx(ae,{className:"w-5 h-5"})})]})]},a.id)})})]}),A&&e.jsx(re,{form:f,setForm:E,onClose:()=>u(!1),onSave:R}),e.jsx(J,{})]}):e.jsx("div",{className:"text-center p-6 font-[Poppins]",children:"Unauthorized"})};export{de as default};
