import{e as F,l as f,j as e,f as R,b as c,y as i,S as $}from"./index-ChEsYP5c.js";import{a as T,b as z,u as I,g as L,f as G,d as H}from"./api-CP9qqBuO.js";import{S as w}from"./SafeImage-BzFbxk5Z.js";import{V as q}from"./VenueCard-CbCR6tpo.js";import{r as J}from"./renderStars-Jiei4OIp.js";function K({booking:a,onCancel:b}){var u,o,l,d,p;const j=F(),t=a.venue,h=[(u=t==null?void 0:t.location)==null?void 0:u.address,(o=t==null?void 0:t.location)==null?void 0:o.city,(l=t==null?void 0:t.location)==null?void 0:l.country].filter(Boolean).join(", "),n=f(new Date(a.dateFrom),"MMM d"),v=f(new Date(a.dateTo),"MMM d");return e.jsxs("div",{onClick:()=>j(`/bookings/${a.id}`),className:"border-2 border-[#C07059] max-w-5xl rounded-2xl overflow-hidden shadow hover:shadow-lg transition bg-white relative animate-fade-in hover:scale-[1.02] hover:ring-2 hover:ring-[#C07059] cursor-pointer",children:[(p=(d=t==null?void 0:t.media)==null?void 0:d[0])!=null&&p.url?e.jsx(w,{src:t.media[0].url,alt:t.name,className:"h-48 w-full object-cover"}):e.jsx("div",{className:"h-48 w-full bg-gray-200 flex items-center justify-center text-sm text-gray-500",children:"No image"}),e.jsxs("section",{className:"p-4 space-y-2",children:[e.jsx("h2",{className:"text-lg font-semibold truncate text-center",children:t==null?void 0:t.name}),e.jsx("p",{className:"text-sm text-gray-600 text-center truncate",children:h}),e.jsxs("p",{className:"text-sm text-gray-800 text-center",children:["$",t==null?void 0:t.price," / night"]}),(t==null?void 0:t.rating)!==void 0&&e.jsx("p",{className:"text-sm text-center",children:J(t.rating)}),e.jsxs("div",{className:"text-xs text-gray-600 space-y-1 mt-2 text-center",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Guests:"})," ",a.guests]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Dates:"})," ",n," → ",v]})]}),e.jsx("div",{className:"flex justify-center mt-4",children:e.jsx("button",{onClick:N=>{N.stopPropagation(),b(a.id)},className:"bg-red-600 text-white font-semibold text-sm text-center px-5 py-2 rounded-2xl w-full sm:w-auto transition-transform duration-150 hover:scale-[1.02]",children:"Cancel Booking"})})]})]})}const Z=()=>{var C,U,M,k;const{user:a,setUser:b}=R(),j=F(),[t,h]=c.useState([]),[n,v]=c.useState([]),[u,o]=c.useState(!1),[l,d]=c.useState({avatarUrl:((C=a==null?void 0:a.avatar)==null?void 0:C.url)||"",bannerUrl:((U=a==null?void 0:a.banner)==null?void 0:U.url)||"",venueManager:(a==null?void 0:a.venueManager)||!1});T(),c.useEffect(()=>{a!=null&&a.name&&z(a.name).then(h).catch(()=>i.error("Error fetching bookings"))},[a]);const p=async()=>{try{const s={bio:a.bio,avatar:{url:l.avatarUrl.trim()||`https://ui-avatars.com/api/?name=${a.name}`,alt:"User avatar"},banner:{url:l.bannerUrl.trim(),alt:"User banner"},venueManager:l.venueManager};await I(a.name,s),b(r=>({...r,...s})),i.success("Profile updated!"),o(!1)}catch{i.error("Failed to update profile")}},N=async s=>{try{const r=await L(),x=G(r,s.search);x.length===1?j(`/venues/${x[0].id}`):v(x)}catch{i.error("Search failed")}},[m,y]=c.useState(1),g=6,D=n.slice((m-1)*g,m*g);return e.jsxs("main",{className:"font-[Poppins] max-w-6xl mx-auto p-4",children:[((M=a==null?void 0:a.banner)==null?void 0:M.url)&&e.jsxs("div",{className:"relative mb-24",children:[e.jsx("img",{src:a.banner.url,alt:"Banner",className:"w-full h-40 object-cover rounded-xl"}),e.jsxs("div",{className:"absolute left-4 bottom-[-6.2rem] sm:left-8 flex items-center gap-4 p-2",children:[e.jsx("img",{src:((k=a.avatar)==null?void 0:k.url)||`https://ui-avatars.com/api/?name=${encodeURIComponent(a.name)}`,alt:"Avatar",className:"w-24 h-24 rounded-full border-4 border-white shadow"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-semibold",children:a.name}),e.jsx("p",{className:"text-gray-600 text-xs break-words",children:a==null?void 0:a.email}),e.jsx("button",{onClick:()=>o(!0),className:"mt-2 button-color text-white px-5 py-1.5 rounded-xl text-sm cursor-pointer",children:"Edit Profile"})]})]})]}),u&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-xl w-full max-w-md space-y-4 relative shadow-lg",children:[e.jsx("button",{className:"absolute top-2 right-3 text-xl cursor-pointer",onClick:()=>o(!1),children:"×"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Edit Profile"}),e.jsx("label",{className:"block text-sm font-medium",children:"Avatar URL"}),e.jsx("input",{type:"url",value:l.avatarUrl,onChange:s=>d(r=>({...r,avatarUrl:s.target.value})),className:"w-full border px-3 py-2 rounded mb-4"}),l.avatarUrl&&e.jsx(w,{src:l.avatarUrl,alt:"Avatar preview",className:"w-20 h-20 mx-auto rounded-full mb-4 border object-cover"}),e.jsx("label",{className:"block text-sm font-medium",children:"Banner URL"}),e.jsx("input",{type:"url",value:l.bannerUrl,onChange:s=>d(r=>({...r,bannerUrl:s.target.value})),className:"w-full border px-3 py-2 rounded mb-4"}),l.bannerUrl&&e.jsx(w,{src:l.bannerUrl,alt:"Banner preview",className:"w-full h-24 object-cover rounded mb-4"}),e.jsx("button",{onClick:p,className:"button-color text-white px-6 py-2 rounded-2xl hover:bg-black w-full sm:w-auto transition-transform duration-150 hover:scale-[1.02] cursor-pointer",children:"Save Changes"})]})}),e.jsx("div",{className:"relative z-20 max-w-5xl mx-auto mb-8",children:e.jsx($,{onFilterChange:N})}),n.length>0&&e.jsxs("section",{className:"mb-8 p-8",children:[e.jsx("h3",{className:"text-3xl font-semibold mb-4",children:"Search Results"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 p-4",children:D.map((s,r)=>e.jsx(q,{venue:s,index:r,filters:{}},s.id))}),e.jsxs("div",{className:"mt-4 flex justify-center items-center gap-4",children:[e.jsx("button",{onClick:()=>y(s=>Math.max(s-1,1)),disabled:m===1,className:"px-3 py-1 button-color text-white rounded-2xl disabled:opacity-50",children:"Prev"}),e.jsxs("span",{children:["Page ",m]}),e.jsx("button",{onClick:()=>y(s=>s*g<n.length?s+1:s),disabled:m*g>=n.length,className:"px-3 py-1 button-color text-white rounded-2xl disabled:opacity-50",children:"Next"})]})]}),e.jsxs("section",{className:"p-8",children:[e.jsxs("h1",{className:"text-5xl font-bold mb-4 p-2",children:["Bookings (",t.length,")"]}),t.length===0?e.jsx("p",{className:"text-gray-500",children:"No bookings found."}):e.jsx("div",{className:"grid md:grid-cols-2 gap-4 cursor-pointer",children:t.map(s=>{var S,B,P;const r=s.venue;[(S=r==null?void 0:r.location)==null?void 0:S.address,(B=r==null?void 0:r.location)==null?void 0:B.city,(P=r==null?void 0:r.location)==null?void 0:P.country].filter(Boolean).join(", "),f(new Date(s.dateFrom),"MMM d"),f(new Date(s.dateTo),"MMM d");const x=async E=>{try{await H(E),h(V=>V.filter(A=>A.id!==E)),i.success("Booking cancelled")}catch{i.error("Failed to cancel booking")}};return e.jsx("div",{className:"py-4",children:e.jsx("div",{className:"space-y-2",children:e.jsx(K,{booking:s,onCancel:x})},s.id)})})})]})]})};export{Z as default};
